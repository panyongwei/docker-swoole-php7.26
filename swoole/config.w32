// $Id$
// vim:ft=javascript

ARG_ENABLE("swoole", "SWOOLE support", "no");

if (PHP_SWOOLE != "no") {
	if (CHECK_LIB("ws2_32.lib", "swoole", PHP_SWOOLE)
	&& CHECK_LIB("Iphlpapi.lib", "swoole", PHP_SWOOLE)
	&& CHECK_HEADER_ADD_INCLUDE("winsock.h", "CFLAGS_SWOOLE")) {
		EXTENSION('swoole', 'swoole.c '
        + 'swoole_server.c '
        + 'swoole_server_port.c '
        + 'swoole_atomic.c '
        + 'swoole_lock.c '
        + 'swoole_client.c '
        + 'swoole_client_coro.cc '
        + 'swoole_coroutine.cc '
        + 'swoole_coroutine_util.c '
        + 'swoole_event.c '
        + 'swoole_socket_coro.cc '
        + 'swoole_timer.c '
        + 'swoole_async.c '
        + 'swoole_process.c '
        + 'swoole_process_pool.c '
        + 'swoole_serialize.c '
        + 'swoole_buffer.c '
        + 'swoole_table.c '
        + 'swoole_http_server.c '
        + 'swoole_http_v2_server.cc '
        + 'swoole_http_v2_client.c '
        + 'swoole_http_v2_client_coro.c '
        + 'swoole_websocket_server.c '
        + 'swoole_http_client.c '
        + 'swoole_http_client_coro.cc '
        + 'swoole_mysql.c '
        + 'swoole_mysql_coro.cc '
        + 'swoole_postgresql_coro.c '
        + 'swoole_redis.c '
        + 'swoole_redis_coro.c '
        + 'swoole_redis_server.c '
        + 'swoole_mmap.c '
        + 'swoole_channel.c '
        + 'swoole_channel_coro.cc '
        + 'swoole_ringqueue.c '
        + 'swoole_msgqueue.c '
        + 'swoole_trace.c '
        + 'swoole_runtime.cc '
        + 'swoole_memory_pool.c '
        + 'thirdparty/swoole_http_parser.c '
        + 'thirdparty/multipart_parser.c '
        + 'src/core/base.c '
        + 'src/core/log.c '
        + 'src/core/hashmap.c '
        + 'src/core/ring_queue.c '
        + 'src/core/channel.c '
        + 'src/core/string.c '
        + 'src/core/array.c '
        + 'src/core/socket.c '
        + 'src/core/list.c '
        + 'src/core/heap.c '
        + 'src/core/error.cc '
        + 'src/coroutine/base.cc '
        + 'src/coroutine/boost.cc '
        + 'src/coroutine/context.cc '
        + 'src/coroutine/ucontext.cc '
        + 'src/coroutine/socket.cc '
        + 'src/coroutine/channel.cc '
    	+ 'src/coroutine/hook.cc '
        + 'src/memory/shared_memory.c '
        + 'src/memory/global_memory.c '
        + 'src/memory/ring_buffer.c '
        + 'src/memory/fixed_pool.c '
        + 'src/memory/malloc.c '
        + 'src/memory/table.c '
        + 'src/memory/buffer.c '
        + 'src/factory/base.c '
        + 'src/factory/thread.c '
        + 'src/factory/process.c '
        + 'src/reactor/base.c '
        + 'src/reactor/select.c '
        + 'src/reactor/poll.c '
        + 'src/reactor/epoll.c '
        + 'src/reactor/kqueue.c '
        + 'src/pipe/base.c '
        + 'src/pipe/eventfd.c '
        + 'src/pipe/unix_socket.c '
        + 'src/lock/semaphore.c '
        + 'src/lock/mutex.c '
        + 'src/lock/rw_lock.c '
        + 'src/lock/spin_lock.c '
        + 'src/lock/file_lock.c '
        + 'src/lock/cond.c '
        + 'src/network/server.c '
        + 'src/network/task_worker.c '
        + 'src/network/client.c '
        + 'src/network/connection.c '
        + 'src/network/process_pool.c '
        + 'src/network/thread_pool.c '
        + 'src/network/reactor_thread.c '
        + 'src/network/reactor_process.c '
        + 'src/network/manager.c '
        + 'src/network/worker.c '
        + 'src/network/timer.c '
        + 'src/network/port.c '
        + 'src/network/dns.c '
        + 'src/network/stream.c '
        + 'src/os/base.c '
        + 'src/os/msg_queue.c '
        + 'src/os/sendfile.c '
        + 'src/os/signal.c '
        + 'src/os/timer.c '
        + 'src/protocol/base.c '
        + 'src/protocol/ssl.c '
        + 'src/protocol/http.c '
        + 'src/protocol/http2.c '
        + 'src/protocol/websocket.c '
        + 'src/protocol/mqtt.c '
        + 'src/protocol/socks5.c '
        + 'src/protocol/mime_types.cc '
        + 'src/protocol/redis.c '
        + 'src/protocol/base64.c', PHP_SWOOLE_SHARED, "-Iext/swoole/ -Iext/swoole/include /DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 /w");
		AC_DEFINE('HAVE_SWOOLE', 1);
		PHP_INSTALL_HEADERS("ext/swoole", "php_swoole.h");
	} else {
		WARNING("swoole not enabled; libraries and headers not found");
	}
}
